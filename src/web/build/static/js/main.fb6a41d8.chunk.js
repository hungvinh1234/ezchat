(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{100:function(e,t,n){},118:function(e,t,n){},125:function(e,t,n){},137:function(e,t,n){},163:function(e,t){},167:function(e,t,n){},168:function(e,t,n){},169:function(e,t,n){},170:function(e,t,n){},171:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(40),i=n.n(r),o=(n(100),n(7)),c=n(8),l=n(13),u=n(12),m=n(14),d=n(31),h=n(23),p=n(176),g=n(174),v=n(87),f=n(5),b=n.n(f),y=n(10),k=n(175),S=n(173),E=n(29),w=n(21),U=n.n(w),O=new(function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,[{key:"getUserId",value:function(){return new Promise(function(e,t){try{e(sessionStorage.getItem("userid"))}catch(n){t(n)}})}},{key:"removeLS",value:function(){return new Promise(function(e,t){try{sessionStorage.removeItem("userid"),sessionStorage.removeItem("username"),e(!0)}catch(n){t(n)}})}},{key:"setLS",value:function(e,t){return new Promise(function(n,a){try{sessionStorage.setItem(e,t),n(!0)}catch(s){a(s)}})}},{key:"login",value:function(e){return new Promise(function(){var t=Object(y.a)(b.a.mark(function t(n,a){return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{E.post(U.a.url+"/login",e).then(function(e){n(e.data)}).catch(function(e){console.log(e.response.data),n(e.response.data)})}catch(s){a(s)}case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"checkUsernameAvailability",value:function(e){return new Promise(function(){var t=Object(y.a)(b.a.mark(function t(n,a){var s;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,E.post(U.a.url+"/usernameAvailable",{username:e});case 3:s=t.sent,n(s.data),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a(t.t0);case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"register",value:function(e){return new Promise(function(){var t=Object(y.a)(b.a.mark(function t(n,a){return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{E.post(U.a.url+"/register",e).then(function(e){n(e.data)}).catch(function(e){return n(e.response.data)})}catch(s){a(s)}case 1:case"end":return t.stop()}},t)}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"userSessionCheck",value:function(e){return new Promise(function(){var t=Object(y.a)(b.a.mark(function t(n,a){var s;return b.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,E.post(U.a.url+"/userSessionCheck",{userId:e});case 3:s=t.sent,n(s.data),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),a(t.t0);case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(e,n){return t.apply(this,arguments)}}())}},{key:"getMessages",value:function(e,t){return new Promise(function(){var n=Object(y.a)(b.a.mark(function n(a,s){var r;return b.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,E.post(U.a.url+"/getMessages",{userId:e,toUserId:t});case 3:r=n.sent,a(r.data),n.next=10;break;case 7:n.prev=7,n.t0=n.catch(0),s(n.t0);case 10:case"end":return n.stop()}},n,null,[[0,7]])}));return function(e,t){return n.apply(this,arguments)}}())}}]),e}()),I=(n(118),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleLogin=function(){var e=Object(y.a)(b.a.mark(function e(t){var a;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n.props.loadingState(!0),e.prev=2,e.next=5,O.login(n.state);case 5:a=e.sent,n.props.loadingState(!1),a.error?alert(a.message):(O.setLS("userid",a.userId),n.props.history.push("/home")),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(2),n.props.loadingState(!1),alert("Invalid login details");case 14:case"end":return e.stop()}},e,null,[[2,10]])}));return function(t){return e.apply(this,arguments)}}(),n.handleInputChange=function(e){n.setState(Object(v.a)({},e.target.name,e.target.value))},n.state={username:"",password:""},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement(k.a,{className:"auth-form"},s.a.createElement(k.a.Group,{controlId:"loginUsername"},s.a.createElement(k.a.Control,{type:"text",name:"username",placeholder:"Enter username",onChange:this.handleInputChange})),s.a.createElement(k.a.Group,{controlId:"loginPassword"},s.a.createElement(k.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:this.handleInputChange})),s.a.createElement(S.a,{className:"btnLogin",type:"submit",onClick:this.handleLogin},"Login"))}}]),t}(a.Component)),j=Object(h.e)(I),C=n(177),L=n(90),x=(n(125),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleRegistration=function(){var e=Object(y.a)(b.a.mark(function e(t){var a,s;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),n.props.loadingState(!0),e.prev=2,a={username:n.state.username,password:n.state.password},e.next=6,O.register(a);case 6:s=e.sent,n.props.loadingState(!1),s.error?alert(s.message):(O.setLS("userid",s.userId),n.props.history.push("/home"),alert("Registration Successful !")),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(2),n.props.loadingState(!1),alert("Unable to register, try after some time"+e.t0);case 15:case"end":return e.stop()}},e,null,[[2,11]])}));return function(t){return e.apply(this,arguments)}}(),n.state={username:"",password:"",usernameAvailable:!0},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(k.a,{className:"auth-form"},s.a.createElement(k.a.Group,{controlId:"formUsername"},s.a.createElement(L.DebounceInput,{className:"form-control",placeholder:"Enter username",minLength:2,debounceTimeout:300,onChange:function(t){return e.setState({username:t.target.value})}}),s.a.createElement(C.a,{className:{"username-availability-warning":!0,"visibility-hidden":this.state.usernameAvailable},variant:"danger"},s.a.createElement("strong",null,this.state.username)," is already taken, try another username.")),s.a.createElement(k.a.Group,{controlId:"formPassword"},s.a.createElement(k.a.Control,{type:"password",name:"password",placeholder:"Password",onChange:function(t){return e.setState({password:t.target.value})}})),s.a.createElement(S.a,{className:"btnRegis",type:"submit",onClick:this.handleRegistration},"Registration"))}}]),t}(a.Component)),N=Object(h.e)(x),M=(n(137),n(43)),R=n.n(M),P=n(44),A=n.n(P),D=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,s=new Array(a),r=0;r<a;r++)s[r]=arguments[r];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={loadingState:!1},n.setRenderLoadingState=function(e){n.setState({loadingState:e})},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:"overlay auth-loading ".concat(this.state.loadingState?"":"visibility-hidden")},s.a.createElement("img",{src:R.a})),s.a.createElement("div",{className:"ezlogo"},s.a.createElement("img",{src:A.a})),s.a.createElement("div",{className:"authentication-screen"},s.a.createElement(p.a,{variant:"pills",defaultActiveKey:"login"},s.a.createElement(g.a,{eventKey:"login",title:"Login"},s.a.createElement(j,{loadingState:this.setRenderLoadingState})),s.a.createElement(g.a,{eventKey:"registration",title:"Registration"},s.a.createElement(N,{loadingState:this.setRenderLoadingState})))))}}]),t}(a.Component),_=n(59),F=n(166),T=new(function(){function e(){Object(o.a)(this,e),this.socket=null,this.eventEmitter=new F.EventEmitter}return Object(c.a)(e,[{key:"establishSocketConnection",value:function(e){try{this.socket=_(U.a.url,{query:"userId=".concat(e)})}catch(t){alert("Something went wrong; Can't connect to socket server")}}},{key:"getChatList",value:function(e){var t=this;this.socket.emit("chat-list",{userId:e}),this.socket.on("chat-list-response",function(e){t.eventEmitter.emit("chat-list-response",e)})}},{key:"sendMessage",value:function(e){this.socket.emit("add-message",e)}},{key:"receiveSeen",value:function(e){this.socket.on("is seen",function(t){e()})}},{key:"sendSeen",value:function(e){this.socket.emit("is seen",e)}},{key:"receiveMessage",value:function(){var e=this;this.socket.on("add-message-response",function(t){e.eventEmitter.emit("add-message-response",t)})}},{key:"logout",value:function(e){var t=this;this.socket.emit("logout",e),this.socket.on("logout-response",function(e){t.eventEmitter.emit("logout-response",e)})}}]),e}()),V=n(28),B=(n(167),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).createChatListUsers=function(e){if(e.error)alert("Unable to load Chat list, Redirecting to Login.");else{var t=n.state.chatListUsers;if(e.singleUser)t.length>0&&(t=t.filter(function(t){return t.id!==e.chatList[0].id})),t=[].concat(Object(V.a)(t),Object(V.a)(e.chatList));else if(e.userDisconnected){var a=t.findIndex(function(t){return t.id===e.userid});a>=0&&(t[a].online="N")}else t=e.chatList;n.setState({chatListUsers:t})}n.setState({loading:!1})},n.selectedUser=function(e){n.setState({selectedUserId:e.id}),n.props.updateSelectedUser(e)},n.state={loading:!0,selectedUserId:null,chatListUsers:[]},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.userId;T.getChatList(e),T.eventEmitter.on("chat-list-response",this.createChatListUsers)}},{key:"componentWillUnmount",value:function(){T.eventEmitter.removeListener("chat-list-response",this.createChatListUsers)}},{key:"render",value:function(){var e=this;return s.a.createElement(s.a.Fragment,null,s.a.createElement("ul",{className:"user-list ".concat(0===this.state.chatListUsers.length?"visibility-hidden":"")},this.state.chatListUsers.map(function(t,n){return s.a.createElement("li",{key:n,className:e.state.selectedUserId===t.id?"active":"",onClick:function(){return e.selectedUser(t)}},t.username,s.a.createElement("span",{className:"Y"===t.online?"online":""}))})),s.a.createElement("div",{className:"alert \n          ".concat(this.state.loading?"alert-info":""," \n          ").concat(this.state.chatListUsers.length>0?"visibility-hidden":"")},this.state.loading||0===this.state.chatListUsers.length.length?"Loading your chat list.":"No User Available to chat."))}}]),t}(a.Component)),G=n(41),K=(n(168),function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).receiveSocketMessages=function(e){var t=n.state.selectedUser;null!==t&&t.id===e.fromUserId&&(n.setState({conversations:[].concat(Object(V.a)(n.state.conversations),[e])}),n.scrollMessageContainer())},n.getMessages=Object(y.a)(b.a.mark(function e(){var t,a,s,r;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=n.props,a=t.userId,s=t.newSelectedUser,e.next=4,O.getMessages(a,s.id);case 4:(r=e.sent).error?alert("Unable to fetch messages"):(n.setState({conversations:r.messages}),n.scrollMessageContainer()),n.setState({messageLoading:!1}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),n.setState({messageLoading:!1});case 12:case"end":return e.stop()}},e,null,[[0,9]])})),n.sendMessage=function(e){if("Enter"===e.key||onclick){var t=e.target.value,a=n.props,s=a.userId,r=a.newSelectedUser;""===t||void 0===t||null===t?alert("Message can't be empty."):""===s?n.router.navigate(["/"]):void 0===r?alert("Select a user to chat."):(n.sendAndUpdateMessages({fromUserId:s,message:t.trim(),toUserId:r.id,isSeen:!1,message_list_name:s+r.id}),e.target.value="")}},n.onFocusMessage=function(){var e=n.state.conversations,t=e[e.length-1];if(t){var a={fromUserId:t.fromUserId,toUserId:t.toUserId};sessionStorage.getItem("userid")!==t.fromUserId&&T.sendSeen(a)}},n.state={messageLoading:!0,conversations:[],selectedUser:null},n.messageContainer=s.a.createRef(),n.setSeen=n.setSeen.bind(Object(G.a)(n)),n.socket=null,n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"setSeen",value:function(){if(void 0!==this.state.conversations[0]){var e=this.state.conversations;e[e.length-1].isSeen=!0,this.setState({conversations:e})}}},{key:"componentDidMount",value:function(){T.receiveMessage(),T.receiveSeen(this.setSeen),T.eventEmitter.on("add-message-response",this.receiveSocketMessages)}},{key:"componentWillUnmount",value:function(){T.eventEmitter.removeListener("add-message-response",this.receiveSocketMessages)}},{key:"componentDidUpdate",value:function(e){null!==e.newSelectedUser&&this.props.newSelectedUser.id===e.newSelectedUser.id||this.getMessages()}},{key:"sendAndUpdateMessages",value:function(e){try{T.sendMessage(e),this.setState({conversations:[].concat(Object(V.a)(this.state.conversations),[e])}),this.scrollMessageContainer()}catch(t){alert("Can't send your message")}}},{key:"scrollMessageContainer",value:function(){var e=this;if(null!==this.messageContainer.current)try{setTimeout(function(){e.messageContainer.current.scrollTop=e.messageContainer.current.scrollHeight},100)}catch(t){console.warn(t)}}},{key:"alignMessages",value:function(e){return this.props.userId!==e}},{key:"showIsSeen",value:function(){var e=this.state.conversations[this.state.conversations.length-1];return this.scrollMessageContainer(),!0===e.isSeen&&e.fromUserId===sessionStorage.getItem("userid")?(console.log("true"),!0):(console.log("fasle"),!1)}},{key:"getMessageUI",value:function(){var e=this;return s.a.createElement("ul",{ref:this.messageContainer,className:"message-thread"},this.state.conversations.map(function(t,n){return s.a.createElement("li",{className:"".concat(e.alignMessages(t.toUserId)?"align-right":""),key:n},t.message)}),s.a.createElement("li",{className:"".concat(this.showIsSeen()?"show-seen":"hide-seen")},"seen"))}},{key:"getInitiateConversationUI",value:function(){if(null!==this.props.newSelectedUser)return s.a.createElement("div",{className:"message-thread start-chatting-banner"},s.a.createElement("p",{className:"heading"},"First time chat with ",this.props.newSelectedUser.username,",",s.a.createElement("span",{className:"sub-heading"}," Say Hi.")))}},{key:"render",value:function(){var e=this.state,t=e.messageLoading,n=e.selectedUser;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"message-overlay ".concat(t?"":"visibility-hidden")},s.a.createElement("h3",{style:{color:"#1DA57A"}}," ",null!==n&&n.username?"Loading Messages":"")),s.a.createElement("div",{className:"message-wrapper ".concat(t?"visibility-hidden":"")},s.a.createElement("div",{className:"message-container"},s.a.createElement("div",{className:"opposite-user"},null!==this.props.newSelectedUser?this.props.newSelectedUser.username:"----"),this.state.conversations.length>0?this.getMessageUI():this.getInitiateConversationUI()),s.a.createElement("div",{className:"message-typer"},s.a.createElement("form",null,s.a.createElement("textarea",{className:"message form-control",placeholder:"Type and hit Enter",onKeyPress:this.sendMessage,onFocus:this.onFocusMessage})))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return null===t.selectedUser||t.selectedUser.id!==e.newSelectedUser.id?{selectedUser:e.newSelectedUser}:null}}]),t}(a.Component)),W=(n(169),n(94)),z=n.n(W),H=function(e){function t(){var e,n;Object(o.a)(this,t);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(n=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(r)))).userId=null,n.state={isOverlayVisible:!0,username:"______",selectedUser:null},n.logout=Object(y.a)(b.a.mark(function e(){return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.removeLS();case 3:T.logout({userId:n.userId}),T.eventEmitter.on("logout-response",function(e){n.props.history.push("/")}),e.next=11;break;case 7:throw e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.t0;case 11:case"end":return e.stop()}},e,null,[[0,7]])})),n.setRenderLoadingState=function(e){n.setState({isOverlayVisible:e})},n.updateSelectedUser=function(e){n.setState({selectedUser:e})},n.getChatBoxComponent=function(){return n.state.isOverlayVisible?null:s.a.createElement(K,{userId:n.userId,newSelectedUser:n.state.selectedUser})},n}return Object(m.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=Object(y.a)(b.a.mark(function e(){var t;return b.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.setRenderLoadingState(!0),e.next=4,O.getUserId();case 4:return this.userId=e.sent,e.next=7,O.userSessionCheck(this.userId);case 7:(t=e.sent).error?this.props.history.push("/"):(this.setState({username:t.username}),O.setLS("username",t.username),T.establishSocketConnection(this.userId)),this.setRenderLoadingState(!1),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),this.setRenderLoadingState(!1),this.props.history.push("/");case 16:case"end":return e.stop()}},e,this,[[0,12]])}));return function(){return e.apply(this,arguments)}}()},{key:"getChatListComponent",value:function(){return this.state.isOverlayVisible?null:s.a.createElement(B,{userId:this.userId,updateSelectedUser:this.updateSelectedUser})}},{key:"render",value:function(){return s.a.createElement("div",{className:"App"},s.a.createElement("div",{className:"".concat(this.state.isOverlayVisible?"overlay":"visibility-hidden"," ")},s.a.createElement("img",{alt:"",src:R.a})),s.a.createElement("header",{className:"app-header"},s.a.createElement("nav",{className:"navbar navbar-expand-md"},s.a.createElement("img",{alt:"",className:"logoicon",src:A.a}),s.a.createElement("h2",{style:{color:"black",paddingLeft:"20px",paddingTop:"10px"}},this.state.username," ")),s.a.createElement("ul",{className:"nav justify-content-end"},s.a.createElement("li",{className:"nav-item"},s.a.createElement(S.a,{className:"logoutbtn",onClick:this.logout},s.a.createElement("img",{alt:"",className:"logouticon",src:z.a}))))),s.a.createElement("main",{role:"main",className:"containerchat content"},s.a.createElement("div",{className:"row chat-content"},s.a.createElement("div",{className:"col-3 chat-list-container"},this.getChatListComponent()),s.a.createElement("div",{className:"col-9 message-container"},this.getChatBoxComponent()))))}}]),t}(a.Component),J=Object(h.e)(H),q=(n(170),function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return s.a.createElement(d.a,{basename:"/abc"},s.a.createElement(h.a,{path:"/",exact:!0,component:D}),s.a.createElement(h.a,{path:"/home/",component:J}))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(s.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},21:function(e,t){e.exports={url:"https://ezchat-realtime.herokuapp.com/"}},43:function(e,t,n){e.exports=n.p+"static/media/loading3.8561f729.gif"},44:function(e,t,n){e.exports=n.p+"static/media/logo.4c1ac505.png"},94:function(e,t,n){e.exports=n.p+"static/media/logout.abad0bee.png"},95:function(e,t,n){e.exports=n(171)}},[[95,1,2]]]);
//# sourceMappingURL=main.fb6a41d8.chunk.js.map